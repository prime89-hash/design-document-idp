# IDP Solution - Complete Infrastructure Diagram
## Detailed Low-Level Infrastructure Architecture

### Document Control
- **Version**: 1.0
- **Last Updated**: January 14, 2026
- **Purpose**: Complete infrastructure visualization including VPC, subnets, and all AWS resources

---

## Complete Infrastructure Architecture

This diagram shows the entire IDP infrastructure including:
- VPC with multiple Availability Zones
- Public and Private Subnets
- All Lambda Functions (7 total)
- Storage Layer (S3, DynamoDB)
- Messaging Layer (SQS, DLQ)
- Orchestration (Step Functions, EventBridge)
- AI/ML (Bedrock Data Automation)
- Monitoring (CloudWatch, SNS, X-Ray)
- Container Registry (ECR)

---

## Legend

```
┌─────┐  AWS Service/Resource
│     │  
└─────┘  

┌═════┐  VPC/Network Boundary
║     ║  
└═════┘  

  →     Data Flow
  ═══   Network Connection
  ···   Optional/Conditional Flow
```

---

## Part 1: External Zone & API Layer

```
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                    AWS CLOUD - EU REGION (eu-west-1)                                                                   ║
║                                                    IDP SOLUTION - COMPLETE INFRASTRUCTURE                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                          EXTERNAL ZONE                                                                                  │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌──────────────────────────────────┐                                    ┌──────────────────────────────────┐                                         │
│  │   ON-PREMISES                    │                                    │   AWS-HOSTED                     │                                         │
│  │   CLIENT APPLICATIONS            │                                    │   CLIENT APPLICATIONS            │                                         │
│  │                                  │                                    │                                  │                                         │
│  │  • UiPath Workflows              │                                    │  • EC2 Applications              │                                         │
│  │  • Internal Systems              │                                    │  • ECS Services                  │                                         │
│  │  • Legacy Applications           │                                    │  • Lambda Functions              │                                         │
│  └────────────┬─────────────────────┘                                    └────────────┬─────────────────────┘                                         │
│               │                                                                       │                                                                 │
│               │ Direct Connect / VPN                                                  │ AWS PrivateLink                                                 │
│               │                                                                       │                                                                 │
└───────────────┼───────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────┘
                │                                                                       │
                │                                    HTTPS                              │
                └───────────────────────────────────────┬───────────────────────────────┘
                                                        │
                                                        ▼
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                          API LAYER                                                                                      │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                        AMAZON API GATEWAY (Regional)                                                                             │ │
│  │                                                                                                                                                   │ │
│  │  Endpoints:                                                                                                                                       │ │
│  │  • POST /upload        → Generate pre-signed S3 URL                                                                                              │ │
│  │  • GET  /status/{id}   → Get document processing status                                                                                          │ │
│  │                                                                                                                                                   │ │
│  │  Configuration:                                                                                                                                   │ │
│  │  • Type: REST API                                                                                                                                 │ │
│  │  • Authorization: AWS_IAM                                                                                                                         │ │
│  │  • Throttling: 1000 req/s, Burst: 2000                                                                                                           │ │
│  │  • Stage: dev/test/prod                                                                                                                           │ │
│  │  • Logging: CloudWatch Logs                                                                                                                       │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
└──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           │ Invoke Lambda
                                                                           ▼
```

## Part 2: Compute Layer (Outside VPC) & Storage Layer

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    COMPUTE LAYER (Outside VPC)                                                                          │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Lambda: Presigned URL Generator                                                                                                                 │ │
│  │  • Runtime: Python 3.12 (Docker)                                                                                                                  │ │
│  │  • Memory: 512 MB | Timeout: 30s | Architecture: ARM64                                                                                            │ │
│  │  • VPC: No (public API Gateway integration)                                                                                                       │ │
│  │  • ECR Image: {account}.dkr.ecr.eu-west-1.amazonaws.com/idp-presigned-url-generator:latest                                                       │ │
│  │  • IAM Role: idp-lambda-execution-role-{env}                                                                                                      │ │
│  │  • Reserved Concurrency: 100                                                                                                                       │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│                                                                          │ Write metadata                                                                │
│                                                                          ▼                                                                               │
└──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           ▼
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                        STORAGE LAYER                                                                                    │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  DynamoDB: Metadata Table                                                                                                                         │ │
│  │  • Table: idp-document-metadata-{env}                                                                                                             │ │
│  │  • PK: document_id (String)                                                                                                                        │ │
│  │  • Attributes: status, document_type, confidences, s3_keys, timestamps                                                                            │ │
│  │  • GSI-1: status-index (PK: status, SK: upload_timestamp)                                                                                         │ │
│  │  • GSI-2: document-type-index (PK: document_type, SK: upload_timestamp)                                                                           │ │
│  │  • Billing: On-Demand                                                                                                                              │ │
│  │  • Encryption: AWS Managed Key                                                                                                                     │ │
│  │  • PITR: Enabled | Stream: Enabled (NEW_AND_OLD_IMAGES)                                                                                           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  S3: Input Documents Bucket                                                                                                                       │ │
│  │  • Bucket: idp-input-documents-{env}-{account-id}                                                                                                 │ │
│  │  • Encryption: AES-256 (SSE-S3)                                                                                                                    │ │
│  │  • Versioning: Disabled                                                                                                                            │ │
│  │  • Lifecycle: Delete after 7 days                                                                                                                  │ │
│  │  • Event Notifications: EventBridge enabled                                                                                                        │ │
│  │  • Public Access: Blocked                                                                                                                          │ │
│  │  • CORS: Enabled (for presigned URL uploads)                                                                                                       │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  S3: Output Documents Bucket                                                                                                                      │ │
│  │  • Bucket: idp-output-documents-{env}-{account-id}                                                                                                │ │
│  │  • Encryption: AES-256 (SSE-S3)                                                                                                                    │ │
│  │  • Versioning: Enabled                                                                                                                             │ │
│  │  • Lifecycle: Transition to IA after 30 days, Delete after 90 days                                                                                │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  S3: Configuration Bucket                                                                                                                          │ │
│  │  • Bucket: idp-config-{env}-{account-id}                                                                                                          │ │
│  │  • Structure: /configs/{document-type}/{config.json, schema.json, prompt.txt}                                                                     │ │
│  │  • Versioning: Enabled                                                                                                                             │ │
│  │  • Encryption: AES-256 (SSE-S3)                                                                                                                    │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  S3: Audit Logs Bucket                                                                                                                             │ │
│  │  • Bucket: idp-audit-logs-{env}-{account-id}                                                                                                      │ │
│  │  • Lifecycle: Transition to Glacier after 90 days, Delete after 365 days                                                                          │ │
│  │  • Object Lock: Enabled (compliance mode)                                                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  DynamoDB: Config Cache Table                                                                                                                     │ │
│  │  • Table: idp-config-cache-{env}                                                                                                                  │ │
│  │  • PK: document_type (String), SK: config_version (String)                                                                                        │ │
│  │  • Billing: On-Demand                                                                                                                              │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           │ S3 Event: ObjectCreated
                                                                           ▼
```

## Part 3: Messaging Layer & Orchestration

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                       MESSAGING LAYER                                                                                   │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  EventBridge: S3 Upload Rule                                                                                                                      │ │
│  │  • Rule: idp-s3-upload-trigger-{env}                                                                                                              │ │
│  │  • Event Pattern: S3 Object Created                                                                                                                │ │
│  │  • Source: aws.s3                                                                                                                                  │ │
│  │  • Target: SQS Queue                                                                                                                               │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│                                                                          │ Send message
                                                                          ▼                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  SQS: Document Processing Queue                                                                                                                   │ │
│  │  • Queue: idp-document-processing-queue-{env}                                                                                                     │ │
│  │  • Type: Standard                                                                                                                                  │ │
│  │  • Visibility Timeout: 900s (15 min)                                                                                                               │ │
│  │  • Message Retention: 14 days                                                                                                                      │ │
│  │  • Max Receive Count: 3                                                                                                                            │ │
│  │  • Long Polling: 20s                                                                                                                               │ │
│  │  • Encryption: SSE-SQS (AWS managed)                                                                                                               │ │
│  │  • DLQ: idp-document-processing-dlq-{env}                                                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│                                                                          │ Poll messages (batch: 10)                                                     │
│                                                                          ▼                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Lambda: SQS Poller                                                                                                                                │ │
│  │  • Runtime: Python 3.12 (Docker)                                                                                                                   │ │
│  │  • Memory: 256 MB | Timeout: 60s | Architecture: ARM64                                                                                             │ │
│  │  • VPC: No                                                                                                                                          │ │
│  │  • Event Source: SQS Queue                                                                                                                          │ │
│  │  • Batch Size: 10 | Batch Window: 5s                                                                                                               │ │
│  │  • Reserved Concurrency: 10                                                                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│                                                                          │ Start execution                                                               │
│                                                                          ▼                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Dead Letter Queue (DLQ)                                                                                                                           │ │
│  │  • Queue: idp-document-processing-dlq-{env}                                                                                                       │ │
│  │  • Type: Standard                                                                                                                                  │ │
│  │  • Message Retention: 14 days                                                                                                                      │ │
│  │  • CloudWatch Alarm: Triggers on message count > 0 (CRITICAL)                                                                                     │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
│                                                                          │ Trigger on DLQ message                                                        │
│                                                                          ▼                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Lambda: DLQ Analyzer                                                                                                                              │ │
│  │  • Runtime: Python 3.12 (Docker)                                                                                                                   │ │
│  │  • Memory: 256 MB | Timeout: 60s                                                                                                                   │ │
│  │  • Purpose: Analyze failed messages and send detailed alerts                                                                                       │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
└──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           │ Publish alert
                                                                           ▼
                                                                    SNS → New Relic/Email/Slack

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    ORCHESTRATION LAYER                                                                                  │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Step Functions: Document Processing State Machine                                                                                                │ │
│  │  • Name: idp-document-processing-{env}                                                                                                             │ │
│  │  • Type: STANDARD                                                                                                                                  │ │
│  │  • Max Execution Time: 15 minutes                                                                                                                  │ │
│  │  • Logging: CloudWatch Logs (ALL events)                                                                                                           │ │
│  │  • Tracing: AWS X-Ray enabled                                                                                                                      │ │
│  │                                                                                                                                                     │ │
│  │  States:                                                                                                                                            │ │
│  │  1. BDA Orchestrator (Task) → Calls BDA for complete processing                                                                                   │ │
│  │  2. Confidence Check (Choice) → Checks classification confidence                                                                                   │ │
│  │  3. Output Processor (Task) → Validates and saves results                                                                                          │ │
│  │  4. Status Update (Task) → Updates DynamoDB and triggers callback                                                                                  │ │
│  │  5. Error Handler (Task) → Handles failures                                                                                                        │ │
│  │                                                                                                                                                     │ │
│  │  Retry Strategy: Exponential backoff (2s, 4s, 8s) - 3 attempts                                                                                    │ │
│  └─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                          │                                                                               │
└──────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           │ Invoke Lambda
                                                                           ▼
```

## Part 4: VPC Architecture (Provided by Evoke) - DETAILED

```
╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                    VPC (Provided by Evoke Landing Zone)                                                                 ║
║                                                    CIDR: 10.0.0.0/16 (example)                                                                          ║
║                                                    Region: eu-west-1                                                                                     ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    AVAILABILITY ZONE 1 (eu-west-1a)                                                                     │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  PRIVATE SUBNET 1                                                                                                                                  │ │
│  │  • CIDR: 10.0.1.0/24                                                                                                                                │ │
│  │  • Route Table: Private-RT-1 → NAT Gateway 1                                                                                                       │ │
│  │  • Network ACL: Default (Allow All)                                                                                                                 │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Lambda: BDA Orchestrator (Primary)                                                                                                         │   │ │
│  │  │  • ENI: eni-abc123 (10.0.1.10)                                                                                                               │   │ │
│  │  │  • Security Group: sg-lambda-idp                                                                                                             │   │ │
│  │  │  • Runtime: Python 3.12 (Docker)                                                                                                             │   │ │
│  │  │  • Memory: 1024 MB | Timeout: 300s                                                                                                           │   │ │
│  │  │  • Reserved Concurrency: 50                                                                                                                  │   │ │
│  │  │  • Purpose: Complete document processing via BDA (language, classification, extraction)                                                     │   │ │
│  │  │  • Outbound: HTTPS (443) to Bedrock via NAT Gateway                                                                                         │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Lambda: Output Processor                                                                                                                   │   │ │
│  │  │  • ENI: eni-def456 (10.0.1.11)                                                                                                               │   │ │
│  │  │  • Security Group: sg-lambda-idp                                                                                                             │   │ │
│  │  │  • Runtime: Python 3.12 (Docker)                                                                                                             │   │ │
│  │  │  • Memory: 512 MB | Timeout: 60s                                                                                                             │   │ │
│  │  │  • Purpose: Validate BDA results and save to S3                                                                                             │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Security Group: sg-lambda-idp                                                                                                               │   │ │
│  │  │  • Inbound: None (Lambda doesn't accept inbound)                                                                                            │   │ │
│  │  │  • Outbound: HTTPS (443) to 0.0.0.0/0 (for AWS service APIs)                                                                                │   │ │
│  │  │  • Description: Allow Lambda to call AWS services (Bedrock, S3, DynamoDB)                                                                   │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  Route Table: Private-RT-1                                                                                                                          │ │
│  │  • 10.0.0.0/16 → local                                                                                                                              │ │
│  │  • 0.0.0.0/0 → NAT Gateway 1 (nat-0abc123)                                                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  PUBLIC SUBNET 1                                                                                                                                   │ │
│  │  • CIDR: 10.0.101.0/24                                                                                                                              │ │
│  │  • Route Table: Public-RT → Internet Gateway                                                                                                       │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  NAT Gateway 1                                                                                                                               │   │ │
│  │  │  • ID: nat-0abc123                                                                                                                           │   │ │
│  │  │  • Elastic IP: 52.123.45.67                                                                                                                  │   │ │
│  │  │  • Purpose: Provide internet access for Lambda functions in private subnet                                                                  │   │ │
│  │  │  • Outbound: Routes to Internet Gateway                                                                                                      │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  Route Table: Public-RT                                                                                                                             │ │
│  │  • 10.0.0.0/16 → local                                                                                                                              │ │
│  │  • 0.0.0.0/0 → Internet Gateway (igw-xyz789)                                                                                                       │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    AVAILABILITY ZONE 2 (eu-west-1b)                                                                     │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  PRIVATE SUBNET 2                                                                                                                                  │ │
│  │  • CIDR: 10.0.2.0/24                                                                                                                                │ │
│  │  • Route Table: Private-RT-2 → NAT Gateway 2                                                                                                       │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Lambda: BDA Orchestrator (Replica)                                                                                                         │   │ │
│  │  │  • ENI: eni-ghi789 (10.0.2.10)                                                                                                               │   │ │
│  │  │  • Security Group: sg-lambda-idp                                                                                                             │   │ │
│  │  │  • Same configuration as AZ1                                                                                                                 │   │ │
│  │  │  • Purpose: High Availability - processes documents if AZ1 fails                                                                            │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Lambda: Output Processor (Replica)                                                                                                         │   │ │
│  │  │  • ENI: eni-jkl012 (10.0.2.11)                                                                                                               │   │ │
│  │  │  • Security Group: sg-lambda-idp                                                                                                             │   │ │
│  │  │  • Same configuration as AZ1                                                                                                                 │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  │  Route Table: Private-RT-2                                                                                                                          │ │
│  │  • 10.0.0.0/16 → local                                                                                                                              │ │
│  │  • 0.0.0.0/0 → NAT Gateway 2 (nat-0def456)                                                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  PUBLIC SUBNET 2                                                                                                                                   │ │
│  │  • CIDR: 10.0.102.0/24                                                                                                                              │ │
│  │  • Route Table: Public-RT → Internet Gateway                                                                                                       │ │
│  │                                                                                                                                                     │ │
│  │  ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │  NAT Gateway 2 (Optional - for HA)                                                                                                          │   │ │
│  │  │  • ID: nat-0def456                                                                                                                           │   │ │
│  │  │  • Elastic IP: 52.123.45.68                                                                                                                  │   │ │
│  │  │  • Purpose: High Availability - backup for NAT Gateway 1                                                                                    │   │ │
│  │  └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                                                                     │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    VPC ENDPOINTS (Optional - Cost Optimization)                                                         │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Gateway Endpoints (Free)                                                                                                                          │ │
│  │  • S3 Gateway Endpoint → Avoids NAT Gateway charges for S3 access                                                                                 │ │
│  │  • DynamoDB Gateway Endpoint → Avoids NAT Gateway charges for DynamoDB access                                                                     │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Interface Endpoints (Paid - $0.01/hour + data transfer)                                                                                          │ │
│  │  • Bedrock Interface Endpoint → Private connectivity to Bedrock (recommended for security)                                                        │ │
│  │  • ECR API Interface Endpoint → For Lambda container image pulls                                                                                  │ │
│  │  • ECR DKR Interface Endpoint → For Docker registry operations                                                                                    │ │
│  │  • CloudWatch Logs Interface Endpoint → For Lambda logging                                                                                        │ │
│  │  • SQS Interface Endpoint → For SQS access from Lambda                                                                                            │ │
│  │  • Secrets Manager Interface Endpoint → For secrets access                                                                                        │ │
│  │                                                                                                                                                     │ │
│  │  Security Group: sg-vpc-endpoints                                                                                                                  │ │
│  │  • Inbound: HTTPS (443) from sg-lambda-idp                                                                                                        │ │
│  │  • Outbound: All traffic                                                                                                                           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    INTERNET GATEWAY                                                                                     │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Internet Gateway                                                                                                                                  │ │
│  │  • ID: igw-xyz789                                                                                                                                  │ │
│  │  • Attached to VPC                                                                                                                                 │ │
│  │  • Purpose: Provide internet access for NAT Gateways in public subnets                                                                            │ │
│  │  • Routes: Public subnets → IGW → Internet                                                                                                         │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                           │
                                                                           │ Internet Access
                                                                           ▼
                                                                    PUBLIC INTERNET
                                                                           │
                                                                           │ HTTPS
                                                                           ▼
                                                                    AWS Bedrock Service
                                                                    (Bedrock Data Automation)
```

## Part 5: AI/ML Layer, Monitoring & Container Registry

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    AI/ML LAYER (AWS Managed Service)                                                                    │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Amazon Bedrock Data Automation (BDA)                                                                                                             │ │
│  │  • Service: Fully managed AWS service                                                                                                              │ │
│  │  • Region: eu-west-1                                                                                                                                │ │
│  │  • Project ARN: arn:aws:bedrock:eu-west-1:123456:data-automation-project/idp-doc-proc                                                             │ │
│  │                                                                                                                                                     │ │
│  │  Capabilities:                                                                                                                                      │ │
│  │  • Language Detection (built-in)                                                                                                                    │ │
│  │  • Document Classification (via blueprints)                                                                                                         │ │
│  │  • Schema Extraction (via blueprints)                                                                                                               │ │
│  │  • OCR and Text Extraction                                                                                                                          │ │
│  │  • Confidence Scoring                                                                                                                               │ │
│  │                                                                                                                                                     │ │
│  │  Models Used:                                                                                                                                       │ │
│  │  • anthropic.claude-3-sonnet-20240229-v1:0 (default - balanced)                                                                                   │ │
│  │  • anthropic.claude-3-haiku-20240307-v1:0 (fast - simple documents)                                                                               │ │
│  │  • anthropic.claude-3-opus-20240229-v1:0 (accurate - complex documents)                                                                           │ │
│  │                                                                                                                                                     │ │
│  │  Blueprints:                                                                                                                                        │ │
│  │  • bp-passport-all-in-one                                                                                                                          │ │
│  │  • bp-bank-statement-all-in-one                                                                                                                    │ │
│  │  • bp-utility-bill-all-in-one                                                                                                                      │ │
│  │  • bp-drivers-license-all-in-one                                                                                                                   │ │
│  │  • ... (one per document type)                                                                                                                     │ │
│  │                                                                                                                                                     │ │
│  │  Access: Via HTTPS from Lambda functions in VPC (through NAT Gateway or VPC Endpoint)                                                             │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    MONITORING & OBSERVABILITY LAYER                                                                     │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Amazon CloudWatch                                                                                                                                 │ │
│  │                                                                                                                                                     │ │
│  │  Log Groups:                                                                                                                                        │ │
│  │  • /aws/lambda/idp-presigned-url-generator-{env}                                                                                                   │ │
│  │  • /aws/lambda/idp-sqs-poller-{env}                                                                                                                │ │
│  │  • /aws/lambda/idp-bda-orchestrator-{env}                                                                                                          │ │
│  │  • /aws/lambda/idp-output-processor-{env}                                                                                                          │ │
│  │  • /aws/lambda/idp-status-updater-{env}                                                                                                            │ │
│  │  • /aws/lambda/idp-document-cleanup-{env}                                                                                                          │ │
│  │  • /aws/lambda/idp-dlq-analyzer-{env}                                                                                                              │ │
│  │  • /aws/stepfunctions/idp-document-processing-{env}                                                                                                │ │
│  │  • /aws/apigateway/idp-api-{env}                                                                                                                   │ │
│  │  Retention: 30 days (configurable)                                                                                                                 │ │
│  │                                                                                                                                                     │ │
│  │  Metrics:                                                                                                                                           │ │
│  │  • DocumentsProcessed (Count)                                                                                                                       │ │
│  │  • ProcessingDuration (Milliseconds)                                                                                                                │ │
│  │  • ClassificationAccuracy (Percent)                                                                                                                 │ │
│  │  • ExtractionConfidence (Percent)                                                                                                                   │ │
│  │  • FailureRate (Percent)                                                                                                                            │ │
│  │  • SQSQueueDepth (Count)                                                                                                                            │ │
│  │  • DLQMessageCount (Count)                                                                                                                          │ │
│  │  • SQSMessageAge (Seconds)                                                                                                                          │ │
│  │                                                                                                                                                     │ │
│  │  Alarms:                                                                                                                                            │ │
│  │  • DLQ Message Count > 0 (CRITICAL)                                                                                                                │ │
│  │  • Lambda Error Rate > 5%                                                                                                                           │ │
│  │  • Step Functions Failed > 10                                                                                                                       │ │
│  │  • API Gateway 5xx > 50                                                                                                                             │ │
│  │  • SQS Queue Depth > 1000                                                                                                                           │ │
│  │  • SQS Message Age > 900s                                                                                                                           │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  AWS X-Ray                                                                                                                                          │ │
│  │  • Tracing: Enabled for all Lambda functions and Step Functions                                                                                    │ │
│  │  • Sampling Rate: 10% (adjustable)                                                                                                                 │ │
│  │  • Service Map: Visual representation of service dependencies                                                                                      │ │
│  │  • Trace Analysis: End-to-end request tracing                                                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Amazon SNS                                                                                                                                         │ │
│  │  • Topic: idp-alerts-{env}                                                                                                                         │ │
│  │  • Subscriptions:                                                                                                                                   │ │
│  │    - Email: ops-team@evoke.com                                                                                                                     │ │
│  │    - HTTPS: New Relic webhook                                                                                                                      │ │
│  │    - HTTPS: Slack webhook                                                                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  New Relic (External)                                                                                                                              │ │
│  │  • Integration: CloudWatch Logs subscription via Kinesis Firehose                                                                                 │ │
│  │  • Metrics: Custom metrics pushed via Lambda extension                                                                                             │ │
│  │  • Dashboards:                                                                                                                                      │ │
│  │    - Document Processing Overview                                                                                                                  │ │
│  │    - Error Rate by Document Type                                                                                                                   │ │
│  │    - Performance Metrics                                                                                                                            │ │
│  │    - Cost Analysis                                                                                                                                  │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    CONTAINER REGISTRY                                                                                   │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Amazon ECR (Elastic Container Registry)                                                                                                           │ │
│  │  • Registry: {account-id}.dkr.ecr.eu-west-1.amazonaws.com                                                                                         │ │
│  │                                                                                                                                                     │ │
│  │  Repositories:                                                                                                                                      │ │
│  │  • idp-presigned-url-generator                                                                                                                     │ │
│  │  • idp-sqs-poller                                                                                                                                  │ │
│  │  • idp-bda-orchestrator                                                                                                                            │ │
│  │  • idp-output-processor                                                                                                                            │ │
│  │  • idp-status-updater                                                                                                                              │ │
│  │  • idp-document-cleanup                                                                                                                            │ │
│  │  • idp-dlq-analyzer                                                                                                                                │ │
│  │                                                                                                                                                     │ │
│  │  Image Tags:                                                                                                                                        │ │
│  │  • {commit-sha} (e.g., abc1234)                                                                                                                    │ │
│  │  • latest                                                                                                                                           │ │
│  │  • {environment}-{timestamp} (e.g., prod-20260114-103000)                                                                                          │ │
│  │                                                                                                                                                     │ │
│  │  Configuration:                                                                                                                                     │ │
│  │  • Scan on Push: Enabled (vulnerability scanning)                                                                                                  │ │
│  │  • Image Tag Immutability: Enabled                                                                                                                 │ │
│  │  • Lifecycle Policy: Keep last 10 images, delete older                                                                                             │ │
│  │  • Encryption: AES-256                                                                                                                              │ │
│  │                                                                                                                                                     │ │
│  │  Access: Lambda functions pull images during deployment and cold starts                                                                            │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                    ADDITIONAL COMPUTE (Outside VPC)                                                                     │
├───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Lambda: Status Updater                                                                                                                            │ │
│  │  • Runtime: Python 3.12 (Docker)                                                                                                                   │ │
│  │  • Memory: 256 MB | Timeout: 30s                                                                                                                   │ │
│  │  • VPC: No                                                                                                                                          │ │
│  │  • Purpose: Update DynamoDB and trigger client callbacks                                                                                           │ │
│  │  • Reserved Concurrency: 100                                                                                                                        │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │  Lambda: Document Cleanup                                                                                                                          │ │
│  │  • Runtime: Python 3.12 (Docker)                                                                                                                   │ │
│  │  • Memory: 256 MB | Timeout: 60s                                                                                                                   │ │
│  │  • VPC: No                                                                                                                                          │ │
│  │  • Trigger: EventBridge scheduled rule (daily at 2 AM UTC)                                                                                         │ │
│  │  • Purpose: Delete old documents from S3 based on retention policy                                                                                 │ │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Summary

### Total AWS Resources

| Category | Count | Resources |
|----------|-------|-----------|
| **VPC Components** | 11 | 1 VPC, 2 AZs, 4 Subnets (2 private, 2 public), 2 NAT Gateways, 1 IGW, 1 Route Table set |
| **Lambda Functions** | 7 | Presigned URL Gen, SQS Poller, BDA Orchestrator, Output Processor, Status Updater, Cleanup, DLQ Analyzer |
| **Storage** | 6 | 4 S3 Buckets, 2 DynamoDB Tables |
| **Messaging** | 3 | 1 EventBridge Rule, 1 SQS Queue, 1 DLQ |
| **Orchestration** | 1 | 1 Step Functions State Machine |
| **API** | 1 | 1 API Gateway |
| **AI/ML** | 1 | 1 BDA Project (AWS managed) |
| **Monitoring** | 3 | CloudWatch, X-Ray, SNS |
| **Container Registry** | 7 | 7 ECR Repositories |
| **Security** | 2 | 2 Security Groups |

**Total**: ~42 AWS resources per environment

---

**Document Status**: Complete  
**Last Updated**: January 14, 2026  
**Includes**: Complete VPC architecture with subnets, NAT Gateways, and all AWS resources
